<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ZEPHENHEL CITADEL</title>

  <link rel="stylesheet" href="./styles.css" />

  <meta http-equiv="Content-Security-Policy"
        content="
        default-src 'self';
        script-src 'self' https://cdn.jsdelivr.net;
        style-src 'self' 'unsafe-inline';
        img-src 'self' data:;
        connect-src 'self' https: wss:;
        frame-ancestors 'none';
        base-uri 'self';
        form-action 'self';
        " />

  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>

<body class="mode-simple">
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="brand-badge">Z</div>
        <div class="brand-text">
          <h1>ZEPHENHEL CITADEL</h1>
          <p>Split Console • BSC • Ethereum • Polygon</p>
        </div>
      </div>

      <div class="pills">
        <div class="pill net" id="pillNet">Network: —</div>
        <div class="pill wallet" id="pillWallet">Wallet: Disconnected</div>

        <!-- SIMPLE / OPERATOR TOGGLE -->
        <button class="btn ghost" id="btnUIMode" title="Toggle Operator Console">
          Operator Console: OFF
        </button>

        <button class="btn ghost" id="btnSwitch">Switch Network</button>
        <button class="btn gold" id="btnConnect">Connect</button>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="warframe">
      <div class="scanlines"></div>
      <div class="gridlines"></div>
      <div class="gloworb a"></div>
      <div class="gloworb b"></div>

      <div class="grid">
        <!-- LEFT: MAIN (always visible) -->
        <section class="card">
          <div class="card-title">
            <h2>Split</h2>
            <div class="badge">Token</div>
          </div>

          <div class="label">Chain</div>
          <select id="selChain">
            <option value="bsc">BSC Mainnet</option>
            <option value="eth">Ethereum Mainnet</option>
            <option value="polygon">Polygon Mainnet</option>
          </select>

          <div class="hr"></div>

          <div class="label">Token Contract</div>
          <input id="inpToken" placeholder="0x…" spellcheck="false" />
          <div class="small" id="tokenSafetyLine">
            Paste token address on the selected chain.
          </div>

          <div class="row2">
            <div>
              <div class="label">Amount</div>
              <input id="inpAmount" placeholder="0.0" inputmode="decimal" />
              <div class="small" id="gasHint">Enter token amount.</div>
            </div>
            <div class="miniCard">
              <div class="miniTitle">Estimate</div>
              <div class="miniValue" id="usdEst">—</div>
              <div class="miniSub" id="postFeeLine">Post-fee output: —</div>
              <div class="miniSub2">Platform fee: <span class="feeTiny">1%</span></div>
            </div>
          </div>

          <div class="btnRow">
            <button class="btn ghost" id="btnNormalize">Normalize</button>
            <button class="btn ghost" id="btnSavePreset">Save</button>
            <button class="btn ghost" id="btnLoadPreset">Load</button>
          </div>

          <div class="hr"></div>

          <div class="card-title" style="margin-bottom:6px;">
            <h2>Recipients</h2>
            <div class="inlineBtns">
              <div class="pill" id="totalPill">Total: 100</div>
              <button class="btn ghost" id="btnAdd">+ Add</button>
            </div>
          </div>

          <div id="recipients"></div>

          <div class="hr"></div>

          <div class="label">Preview (post-fee)</div>
          <div class="small" id="previewHint">
            Preview is computed locally and validated by preflight simulation.
          </div>

          <div class="tableWrap">
            <table class="previewTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Recipient</th>
                  <th>Share</th>
                  <th>Amount</th>
                  <th>Explorer</th>
                </tr>
              </thead>
              <tbody id="previewBody">
                <tr><td colspan="5" class="mutedCell">—</td></tr>
              </tbody>
            </table>
          </div>

          <div class="btnRow">
            <button class="btn ghost" id="btnApprove">Approve</button>
            <button class="btn gold" id="btnExecute">Execute</button>
          </div>

          <div class="notice" id="tipBox">
            Simple Mode: clean UX. Operator Console: telemetry + logs + deeper diagnostics.
          </div>

          <div class="error" id="errBox" style="display:none;"></div>

          <div class="footer-note">Always test small amounts first.</div>
        </section>

        <!-- RIGHT: OPERATOR CONSOLE (hidden in Simple Mode) -->
        <section class="card operator-only" id="operatorPanel">
          <div class="card-title">
            <h2>Operator Console</h2>
            <label class="soundToggle">
              <input type="checkbox" id="chkSound" checked />
              <span>Sound FX</span>
            </label>
          </div>

          <div class="teleGrid">
            <div class="teleBox">
              <div class="teleK">Native Balance</div>
              <div class="teleV" id="teleNative">—</div>
            </div>
            <div class="teleBox">
              <div class="teleK">Token</div>
              <div class="teleV" id="teleSymbol">—</div>
            </div>
            <div class="teleBox">
              <div class="teleK">Decimals</div>
              <div class="teleV" id="teleDecimals">—</div>
            </div>
            <div class="teleBox">
              <div class="teleK">Token Balance</div>
              <div class="teleV" id="teleTokenBal">—</div>
            </div>
            <div class="teleBox">
              <div class="teleK">Allowance → Splitter</div>
              <div class="teleV" id="teleAllowance">—</div>
            </div>
            <div class="teleBox">
              <div class="teleK">Active Splitter</div>
              <div class="teleV mono" id="teleSplitter">—</div>
            </div>
            <div class="teleBox">
              <div class="teleK">Fee Wallet</div>
              <div class="teleV mono" id="teleFeeWallet">—</div>
            </div>
            <div class="teleBox">
              <div class="teleK">Status</div>
              <div class="teleV" id="teleStatus">Ready.</div>
            </div>
          </div>

          <div class="hr"></div>

          <div class="card-title" style="margin-bottom:6px;">
            <h2>Runtime Log</h2>
            <div class="inlineBtns">
              <button class="btn ghost" id="btnRefresh">Refresh</button>
              <button class="btn ghost" id="btnClear">Clear</button>
            </div>
          </div>

          <pre class="log" id="log"></pre>

          <div class="footer-note">Operator console is for debugging + proof.</div>
        </section>
      </div>
    </div>
  </main>

  <!-- CONFIRM MODAL -->
  <div class="modal" id="confirmModal" style="display:none;">
    <div class="modalCard">
      <div class="modalTitle">Confirm Split Execution</div>
      <div class="modalBody" id="confirmBody"></div>
      <div class="modalActions">
        <button class="btn ghost" id="btnCancelModal">Cancel</button>
        <button class="btn gold" id="btnConfirmModal">CONFIRM + SEND</button>
      </div>
      <div class="small modalFoot">
        You are about to send an on-chain transaction. Verify chain + token + recipients.
      </div>
    </div>
  </div>

  <script src="./app.js"></script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ZEPHENHEL CITADEL</title>
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <!-- Topbar -->
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="brand-badge">Z</div>
        <div class="brand-text">
          <h1>ZEPHENHEL CITADEL</h1>
          <p>Mythic tri-chain splitter • BSC • Ethereum • Polygon</p>
        </div>
      </div>

      <div class="pills">
        <div class="pill net" id="pillNet">Network: —</div>
        <div class="pill wallet" id="pillWallet">Wallet: Disconnected</div>
        <button class="btn gold" id="btnConnect">Connect</button>
        <button class="btn ghost" id="btnSwitch">Switch Network</button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" id="tabBtnSplit">Splitter</button>
      <button class="tab" id="tabBtnVault">Inheritance Vault</button>
      <div class="tabs-right">
        <label class="toggle">
          <input type="checkbox" id="toggleSound" checked />
          <span>Sound FX</span>
        </label>
      </div>
    </div>

    <!-- SPLITTER -->
    <section id="tabSplit" class="tabPanel active">
      <div class="grid splitGrid">

        <!-- Left card: Split command -->
        <div class="card splitCard">
          <div class="card-title">
            <h2>Split Command</h2>
            <div class="chip" id="chipMode">Mode: Token Split</div>
          </div>

          <div class="fieldRow">
            <div class="field">
              <div class="label">Chain</div>
              <select id="selChain">
                <option value="56">BSC Mainnet</option>
                <option value="1">Ethereum Mainnet</option>
                <option value="137">Polygon Mainnet</option>
              </select>
            </div>

            <div class="field">
              <div class="label">Split Type</div>
              <select id="selSplitType">
                <option value="token">Token Split (ERC20 / BEP20)</option>
                <option value="native">Native Split (BNB / ETH / MATIC)</option>
              </select>
            </div>
          </div>

          <div class="hr"></div>

          <div class="field">
            <div class="label">Token address (ERC20/BEP20) — Token split only</div>
            <input id="inpToken" placeholder="0x..." />
            <div class="small">Tip: For USDC/USDT, paste the token contract address on the selected chain.</div>
          </div>

          <div class="fieldRow">
            <div class="field">
              <div class="label">Amount</div>
              <input id="inpAmount" placeholder="0.0" inputmode="decimal" />
              <div class="small" id="amountHint">Enter a token amount.</div>
            </div>

            <div class="field">
              <div class="label">MAX</div>
              <button class="btn ghost w100" id="btnMax">MAX (gas-safe)</button>
              <div class="small" id="maxHint">Reserves gas for native coins automatically.</div>
            </div>
          </div>

          <div class="notice" id="feeNotice">
            Platform fee: <b>1%</b> (shown small). Citadel will auto-detect the percent scale your splitter expects.
          </div>

          <div class="hr"></div>

          <div class="card-title">
            <h2>Recipients</h2>
            <div class="inline">
              <div class="pillMini" id="pillTotal">Total: 100.00%</div>
              <button class="btn ghost" id="btnAddRecipient">+ Add</button>
              <button class="btn ghost" id="btnNormalize">Normalize</button>
            </div>
          </div>

          <div id="recipients"></div>

          <div class="actions">
            <button class="btn ghost" id="btnApprove">Approve</button>
            <button class="btn gold" id="btnExecute">Execute Split</button>
          </div>

          <div class="error" id="errBox" style="display:none;"></div>
          <div class="footer-note">Always test small amounts first.</div>
        </div>

        <!-- Right card: Telemetry -->
        <div class="card telemetryCard">
          <div class="card-title">
            <h2>Live Telemetry</h2>
            <div class="inline">
              <button class="btn ghost" id="btnRefresh">Refresh</button>
              <button class="btn ghost" id="btnClearLog">Clear</button>
            </div>
          </div>

          <div class="telemetryGrid">
            <div class="tcard">
              <div class="tlabel">Native balance</div>
              <div class="tvalue" id="tvNative">—</div>
              <div class="tmuted" id="tvNativeUsd">—</div>
            </div>

            <div class="tcard">
              <div class="tlabel">Token symbol</div>
              <div class="tvalue" id="tvSymbol">—</div>
              <div class="tmuted" id="tvDecimals">Decimals: —</div>
            </div>

            <div class="tcard">
              <div class="tlabel">Token balance</div>
              <div class="tvalue" id="tvTokenBal">—</div>
              <div class="tmuted" id="tvTokenUsd">—</div>
            </div>

            <div class="tcard">
              <div class="tlabel">Allowance → splitter</div>
              <div class="tvalue" id="tvAllow">—</div>
              <div class="tmuted" id="tvSplitter">Active splitter: —</div>
            </div>

            <div class="tcard wide">
              <div class="tlabel">Planned amount</div>
              <div class="tvalue" id="tvPlanned">—</div>
              <div class="tmuted" id="tvReceive">You receive (post-fee): —</div>
            </div>

            <div class="tcard wide">
              <div class="tlabel">Contract scale auto-detected</div>
              <div class="tvalue" id="tvScale">—</div>
              <div class="tmuted" id="tvScaleHint">Auto tries: 10000 / 100 and fee-adjust variants.</div>
            </div>
          </div>

          <div class="hr"></div>

          <div class="card-title">
            <h2>Runtime Log</h2>
            <div class="chip" id="chipStatus">Ready.</div>
          </div>
          <pre class="log" id="log"></pre>
        </div>

      </div>
    </section>

    <!-- VAULT (safe UI shell + contract switching; calls are guarded so it won’t break your app if ABI differs) -->
    <section id="tabVault" class="tabPanel">
      <div class="grid splitGrid">
        <div class="card">
          <div class="card-title">
            <h2>Inheritance Vault</h2>
            <div class="chip">Guarded Release</div>
          </div>

          <div class="fieldRow">
            <div class="field">
              <div class="label">Chain</div>
              <select id="selVaultChain">
                <option value="56">BSC Mainnet</option>
                <option value="1">Ethereum Mainnet</option>
                <option value="137">Polygon Mainnet</option>
              </select>
            </div>
            <div class="field">
              <div class="label">Vault contract (auto)</div>
              <input id="inpVaultAddr" readonly />
            </div>
          </div>

          <div class="notice">
            This tab is wired to your deployed vault addresses. Functions are called only if present in the contract ABI.
            If your vault ABI differs, it will show a readable error instead of breaking the site.
          </div>

          <div class="hr"></div>

          <div class="fieldRow">
            <div class="field">
              <div class="label">Token address</div>
              <input id="vaultToken" placeholder="0x..." />
            </div>
            <div class="field">
              <div class="label">Beneficiary address</div>
              <input id="vaultBeneficiary" placeholder="0x..." />
            </div>
          </div>

          <div class="fieldRow">
            <div class="field">
              <div class="label">Amount</div>
              <input id="vaultAmount" placeholder="0.0" inputmode="decimal" />
            </div>
            <div class="field">
              <div class="label">Release time (UTC)</div>
              <input id="vaultRelease" placeholder="YYYY-MM-DD HH:MM" />
            </div>
          </div>

          <div class="actions">
            <button class="btn ghost" id="btnVaultApprove">Approve</button>
            <button class="btn gold" id="btnVaultCreate">Create Vault</button>
          </div>

          <div class="error" id="vaultErr" style="display:none;"></div>
        </div>

        <div class="card">
          <div class="card-title">
            <h2>Vault Tools</h2>
            <div class="chip">Inspect / Trigger</div>
          </div>

          <div class="fieldRow">
            <div class="field">
              <div class="label">Vault ID</div>
              <input id="vaultId" placeholder="e.g. 0" inputmode="numeric" />
            </div>
            <div class="field">
              <div class="label">Label (optional)</div>
              <input id="vaultLabel" placeholder="e.g. College fund" />
            </div>
          </div>

          <div class="actions">
            <button class="btn ghost" id="btnVaultInspect">Inspect</button>
            <button class="btn gold" id="btnVaultTrigger">Trigger (if eligible)</button>
          </div>

          <pre class="log" id="vaultLog"></pre>
        </div>
      </div>
    </section>
  </main>

  <!-- Ethers v5 CDN -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="./app.js"></script>
</body>
</html>

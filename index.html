<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ZEPHENHEL CITADEL</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;800&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <div class="bg"></div>

  <header class="top">
    <div class="brand">
      <div class="mark">✠</div>
      <div class="brandtext">
        <div class="title">ZEPHENHEL <span class="gold">CITADEL</span></div>
        <div class="sub">Mythic Black • Gold • Distribution Command</div>
      </div>
    </div>

    <div class="right">
      <div class="chip" id="mmChip">MetaMask: <b>—</b></div>
      <div class="chip" id="netChip">Chain: <b>—</b></div>
      <div class="chip" id="acctChip">Wallet: <b>DISCONNECTED</b></div>

      <button class="btn gold" id="connectBtn">CONNECT</button>
      <button class="btn" id="switchBtn" title="Switch to BSC">SWITCH TO BSC</button>
    </div>
  </header>

  <main class="wrap grid">
    <section class="console">
      <div class="panelTitle">CONTROL CORE</div>

      <div class="row">
        <div class="field">
          <label>SPLITTER (BSC)</label>
          <input id="splitter" placeholder="0x..." spellcheck="false" />
        </div>
      </div>

      <div class="row two">
        <div class="field">
          <label>TOKEN ADDRESS</label>
          <input id="token" placeholder="0x..." spellcheck="false" />
          <div class="micro" id="tokenMeta">Token: — • Decimals: — • Price: —</div>
          <div class="micro">
            Balance: <span class="gold" id="bal">—</span>
            Allowance: <span class="gold" id="alw">—</span>
          </div>
        </div>

        <div class="field">
          <label>AMOUNT</label>
          <input id="amount" placeholder="0.0" inputmode="decimal" />
          <div class="micro">
            ≈ <span class="gold" id="usd">$—</span>
            <span class="tiny">platform fee: 1%</span>
          </div>
        </div>
      </div>

      <div class="row head">
        <div class="h">RECIPIENTS</div>
        <div class="h2">
          Total: <b id="total">0%</b>
          <button class="btn mini" id="addBtn">+ ADD</button>
        </div>
      </div>

      <div id="list" class="list"></div>

      <div class="row actions">
        <button class="btn" id="approveBtn">APPROVE</button>
        <button class="btn gold" id="splitBtn">EXECUTE SPLIT</button>
      </div>

      <div id="warn" class="warn" hidden></div>

      <div class="receipt" id="receipt" hidden>
        <div class="receiptHead">
          <div class="h">RECEIPT</div>
          <a id="txLink" class="btn mini" href="#" target="_blank" rel="noreferrer" style="display:none;">VIEW TX</a>
        </div>
        <pre id="receiptText"></pre>
        <button class="btn mini" id="copyBtn">COPY RECEIPT</button>
      </div>
    </section>

    <aside class="side">
      <div class="console sidePanel">
        <div class="panelTitle">RUNTIME LOG</div>
        <div class="log" id="log"></div>
        <button class="btn mini" id="clearLog">CLEAR</button>

        <div class="divider"></div>

        <div class="panelTitle">QUICK CHECKS</div>
        <div class="micro">
          • If MetaMask shows “NO”, your extension isn’t injecting on this page.<br/>
          • If Chain isn’t BSC, hit “SWITCH TO BSC”.<br/>
          • If Token price is “—”, DexScreener has no price for that token.
        </div>
      </div>
    </aside>
  </main>

  <!-- Ethers (primary + fallback) -->
  <script>
    window.__loadEthers = function(src, next){
      return new Promise((resolve, reject) => {
        const s = document.createElement("script");
        s.src = src; s.defer = true;
        s.onload = () => resolve(true);
        s.onerror = () => reject(new Error("Failed: " + src));
        document.head.appendChild(s);
      });
    }
  </script>
  <script>
    (async () => {
      try {
        await window.__loadEthers("https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js");
      } catch(e1) {
        try {
          await window.__loadEthers("https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js");
        } catch(e2) {
          console.error(e1, e2);
        }
      }
    })();
  </script>

  <script defer src="./app.js"></script>
</body>
</html>
